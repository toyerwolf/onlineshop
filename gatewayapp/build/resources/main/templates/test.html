<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Shopping</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f2f2f2;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-links {
            text-align: right;
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .auth-links a {
            color: #4CAF50;
            text-decoration: none;
            margin-left: 10px;
        }

        .auth-links a:hover {
            text-decoration: underline;
        }

        .search-bar {
            text-align: right;
            margin-bottom: 20px;
        }

        .search-bar input[type="text"] {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            width: 200px;
        }

        .search-bar button {
            padding: 10px 20px;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        .category-list {
            display: none;
            flex-wrap: wrap;
            justify-content: center;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .category-list.active {
            display: flex;
        }

        .category-card {
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            width: 250px;
            margin: 15px;
        }

        .category-card h3 {
            margin-top: 10px;
            margin-bottom: 5px;
            font-size: 20px;
        }

        .category-card p {
            margin-bottom: 10px;
            color: #666;
            font-size: 16px;
        }

        .category-card button {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
        }

        .category-card button:hover {
            background-color: #45a049;
        }

        .product-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .product-card {
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            width: 250px;
            margin: 15px;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; /* –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã */
        }

        .product-card:hover {
            transform: translateY(-5px); /* –ü–æ–¥–Ω—è—Ç–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* –£—Å–∏–ª–µ–Ω–Ω–∞—è —Ç–µ–Ω—å –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        }

        .product-card img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
        }

        .product-card h3 {
            margin-top: 10px;
            margin-bottom: 5px;
            font-size: 18px;
        }

        .product-card p {
            margin-bottom: 10px;
            color: #666;
            font-size: 16px;
        }

        .product-card .price {
            font-weight: bold;
            color: #4CAF50;
            font-size: 18px;
        }

        .product-card .quantity {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
        }

        .product-card .quantity button {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
        }

        .product-card .quantity input {
            width: 50px;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin: 0 10px;
            padding: 5px;
        }

        .product-card .quantity input:focus {
            outline: none;
        }

        .product-card .quantity button:hover {
            background-color: #45a049;
        }

        .pagination {
            text-align: center; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
            margin-top: 20px; /* –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
        }

        .pagination a {
            color: #4CAF50;
            text-decoration: none;
            padding: 5px 10px;
            margin: 0 5px;
            border: 1px solid #4CAF50;
            border-radius: 3px;
        }

        .pagination a:hover {
            background-color: #4CAF50;
            color: white}

        .pagination a {
            color: #4CAF50;
            text-decoration: none;
            padding: 5px 10px;
            margin: 0 5px;
            border: 1px solid #4CAF50;
            border-radius: 3px;
        }

        .pagination a:hover {
            background-color: #4CAF50;
            color: white;
        }

        .logout-button, #my-orders-button {
            background-color: #ff4444;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-left: 10px;
        }

        .logout-button:hover, #my-orders-button:hover {
            background-color: #cc0000;
        }

        /*.weather-container {*/
        /*    position: sticky; !* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –¥–ª—è –±–ª–æ–∫–∞,esli fixed no ne budet zaviset ot kursora//fixed *!*/
        /*    top: 20px; !* –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É *!*/
        /*    left: 20px; !* –û—Ç—Å—Ç—É–ø —Å–ª–µ–≤–∞ *!*/
        /*    padding: 10px; !* –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –æ—Ç—Å—Ç—É–ø –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ *!*/
        /*    background-color: #f0f0f0; !* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ *!*/
        /*    border: 1px solid #ccc; !* –†–∞–º–∫–∞ *!*/
        /*    border-radius: 5px; !* –ó–∞–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ *!*/
        /*    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); !* –¢–µ–Ω—å *!*/
        /*    width: 250px; !* –®–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∞ *!*/
        /*}*/

        .weather-container {
            position: sticky;
            top: 20px; /* –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –æ—Ç –Ω–∞—á–∞–ª–∞ "–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ" —Å–æ—Å—Ç–æ—è–Ω–∏—è */
            padding: 10px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 250px;
            z-index: 1000; /* –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –ø–æ–≤–µ—Ä—Ö –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        }

        .weather-location {
            font-size: 1.2em; /* –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
            font-weight: bold; /* –ñ–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
            margin-bottom: 10px; /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
        }

        .weather-temperature {
            font-size: 2em; /* –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã */
            margin-bottom: 10px; /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã */
        }

        .weather-icon {
            width: 50px; /* –®–∏—Ä–∏–Ω–∞ –∏–∫–æ–Ω–∫–∏ */
            height: 50px; /* –í—ã—Å–æ—Ç–∞ –∏–∫–æ–Ω–∫–∏ */
            margin-bottom: 10px; /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è –∏–∫–æ–Ω–∫–∏ */
        }

        .weather-description {
            font-size: 0.9em; /* –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è */
        }

        #my-orders-button {
            padding: 10px 20px; /* –ü–æ–¥—Ö–æ–¥—è—â–∏–µ –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è –∫–Ω–æ–ø–∫–∏ */
            font-size: 16px; /* –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∫–Ω–æ–ø–∫–µ */
            background-color: #007bff; /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –∫–Ω–æ–ø–∫–∏ */
            color: #fff; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∫–Ω–æ–ø–∫–µ */
            border: none; /* –£–±–∏—Ä–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—É –∫–Ω–æ–ø–∫–∏ */
            border-radius: 5px; /* –ó–∞–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ –∫–Ω–æ–ø–∫–∏ */
            cursor: pointer; /* –ò–∑–º–µ–Ω—è–µ–º –∫—É—Ä—Å–æ—Ä –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
            transition: background-color 0.3s ease; /* –ü–ª–∞–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ —Ñ–æ–Ω–∞ */
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "My Orders" –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        #my-orders-button:hover {
            background-color: #0056b3; /* –¢–µ–º–Ω—ã–π –æ—Ç—Ç–µ–Ω–æ–∫ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
        }

        .header-image {
            width: 100%; /* –®–∏—Ä–∏–Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—É–¥–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å 100% –¥–æ—Å—Ç—É–ø–Ω–æ–π —à–∏—Ä–∏–Ω—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
            height: auto; /* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –≤—ã—Å–æ—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏–π */
            object-fit: cover; /* –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–µ–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
            display: block;
            margin: 0 auto 30px auto; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
            max-width: 1500px; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —à–∏—Ä–∏–Ω—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
            max-height: 300px; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≤—ã—Å–æ—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
        }

        .price {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .original-price {
            text-decoration: line-through;
            color: #999;
            margin-right: 5px;
        }

        .discounted-price {
            font-weight: bold;
            color: #4CAF50;
        }

        .rating {
            unicode-bidi: bidi-override;
            direction: rtl;
            text-align: center;
        }

        .rating > .star {
            display: inline-block;
            position: relative;
            font-size: 20px;
            color: #ddd;
            cursor: pointer;
        }

        .rating > .star:hover:before,
        .rating > .star:hover ~ .star:before {
            content: '\2605';
            position: absolute;
            color: gold;
        }

        .rating > .star.active:before,
        .rating > .star.active ~ .star:before {
            content: '\2605';
            position: absolute;
            color: gold;
        }

        .dice-container {
            text-align: center;
            margin-top: 20px;
        }

        .dice {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        .dice:hover {
            background-color: #0056b3;
        }

        .rating .like.active {
            color: red; /* –ò–∑–º–µ–Ω–∏—Ç–µ —Ü–≤–µ—Ç –Ω–∞ –∫—Ä–∞—Å–Ω—ã–π –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ "–ª–∞–π–∫–∞" */
        }

        .rating .dislike.active {
            color: rgb(128, 128, 128); /* –ò–∑–º–µ–Ω–∏—Ç–µ —Ü–≤–µ—Ç –Ω–∞ —Å–µ—Ä—ã–π –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ "–¥–∏–∑–ª–∞–π–∫–∞" */
        }

    </style>
</head>
<body>
<!--<div id="orders-section"></div>-->

<div id="weather-container" class="weather-container">
    <div class="weather-location">Baku</div>
    <div class="weather-temperature" id="weather-temperature">--¬∞C</div>
    <img class="weather-icon" id="weather-icon" src="" alt="Weather Icon">
    <div class="weather-description" id="weather-description">Loading...</div>
</div>

<div class="container">
    <div class="auth-links">
        <div id="auth-links-logged-out">
            <a href="/login">Login</a>
            <a href="/register">Register</a>
        </div>
        <div id="auth-links-logged-in" style="display:none;">
            <span>Welcome, <span id="customer-name">User</span>!</span>
            <button class="logout-button" onclick="logoutUser()">Logout</button>
            <button id="my-orders-button" onclick="viewCustomerOrders()">My Orders</button>
        </div>
    </div>

    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
    <div style="text-align: center; margin-bottom: 30px;">
        <img src="/static/istck.jpg" alt="Welcome Image" class="header-image" style="width: 80%; max-width: 1000px;">
    </div>

    <div class="search-bar">
        <input type="text" id="search-input" placeholder="Search...">
        <button id="search-button">Search</button>
    </div>

    <button id="all-categories-button">All Categories</button>

    <ul id="categories-section" class="category-list"></ul>


    <div class="container">
        <!--        <h1>Featured Products</h1>-->

        <div id="products-section" class="product-list">
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∑–¥–µ—Å—å -->
            <div class="product-card" th:each="product : ${products.content}" th:data-product-id="${product.id}">
                <img th:src="${product.imageUrl}" alt="Product Image">
                <h3 th:text="${product.name}"></h3>
                <p th:text="${product.categoryName}"></p>
                <p class="price" th:if="${product.discountPrice != null}">
                    <span class="original-price" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 2, 'POINT')}"></span>
                    <span class="discounted-price" th:text="${#numbers.formatDecimal(product.discountPrice, 0, 'COMMA', 2, 'POINT')}"></span>
                </p>
                <p class="price" th:if="${product.discountPrice == null}">
                    <span th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 2, 'POINT')}"></span>
                </p>
                <div class="quantity">
                    <button class="quantity-btn" onclick="decrementQuantity(this)">-</button>
                    <label>
                        <input type="number" class="quantity-input" value="1" min="1">
                    </label>
                    <button class="quantity-btn" onclick="incrementQuantity(this)">+</button>
                </div>
                <div class="rating" data-product-id="${product.id}">
                    <span class="like" data-value="1" onclick="rateProduct(this)">üëç</span>
                    <span class="dislike" data-value="0" onclick="rateProduct(this)">üëé</span>
                </div>

                <div class="average-rating">
                    <!-- –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø—Ä–æ–¥—É–∫—Ç–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
                <button class="make-order-button" onclick="makeOrder(this.closest('.product-card').getAttribute('data-product-id'))">Make Order</button>
            </div>

        </div>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        <div class="pagination">
            <a th:if="${products.hasPrevious()}" th:href="@{/ (page=${products.number})}">Previous</a>
            <span th:each="i : ${#numbers.sequence(1, products.totalPages)}" th:if="${i >= products.number - 2 && i <= products.number + 2}">
            <a th:href="@{/ (page=${i})}" th:text="${i}" th:classappend="${i == products.number + 1} ? 'active' : ''"></a>
        </span>
            <a th:if="${products.hasNext()}" th:href="@{/ (page=${products.number + 2})}">Next</a>
        </div>
    </div>

    <div class="dice-container">
        <button class="dice" onclick="rollDice()">–ë—Ä–æ—Å–∏—Ç—å –∫–æ—Å—Ç–∏</button>
    </div>

    <button id="back-button" style="display: none;">Back</button>


    <div id="product-details">
        <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ -->
    </div>


</div>





<script>

    document.addEventListener('DOMContentLoaded', function() {
        const productsSection = document.getElementById('products-section');

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
        productsSection.addEventListener('click', function(event) {
            const card = event.target.closest('.product-card');
            const likeIcon = event.target.closest('.like');
            const dislikeIcon = event.target.closest('.dislike');

            if (card && !event.target.classList.contains('star')) { // –£—Å–ª–æ–≤–∏–µ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–∫–æ–≤ –ø–æ –∑–≤–µ–∑–¥–æ—á–∫–∞–º
                const productId = card.getAttribute('data-product-id');
                savePageState(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

                if (likeIcon || dislikeIcon) {
                    event.preventDefault(); // –û—Ç–º–µ–Ω—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ "like" –∏–ª–∏ "dislike"
                    const ratingValue = likeIcon ? 1 : 0; // 1 –¥–ª—è "like", 0 –¥–ª—è "dislike"
                    rateProduct(productId, ratingValue); // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ü–µ–Ω–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                } else {
                    window.location.href = `/product-details?id=${productId}`; // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞
                }
            }
        });
    });


    function checkTokenExpiration() {
        const refreshTokenExpiration = localStorage.getItem('refresh_token_expiration');
        const currentTime = new Date().getTime() / 1000;

        if (refreshTokenExpiration && currentTime > refreshTokenExpiration) {
            logout(); // –ï—Å–ª–∏ refreshToken –∏—Å—Ç–µ–∫, —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        } else {
            refreshToken(); // –û–±–Ω–æ–≤–ª—è–µ–º refreshToken, –µ—Å–ª–∏ –æ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
        }
    }

    setInterval(checkTokenExpiration, 75000);


    document.addEventListener('DOMContentLoaded', function() {
        const accessToken = localStorage.getItem('access_token');
        const rollDiceButton = document.querySelector('.dice');

        if (!accessToken) {
            rollDiceButton.style.display = 'none';
        } else {
            rollDiceButton.style.display = 'inline-block'; // –∏–ª–∏ 'block', –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–µ–≥–æ —Å—Ç–∏–ª—è
        }
    });

    function rollDice() {
        const accessToken = localStorage.getItem('access_token');
        if (!accessToken) {
            console.error('Access token not found. Unable to roll dice.');
            return;
        }

        const customerId = localStorage.getItem('customerId');
        const productId = 5; // ID –ø—Ä–æ–¥—É–∫—Ç–∞ iPhone 15
        const url = `/api/roll-dice?customerId=${customerId}&productId=${productId}`;

        fetch(url, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${accessToken}`
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to roll dice');
                }
                return response.json();
            })
            .then(data => {
                handleDiceRollResult(data);
            })
            .catch(error => {
                console.error('Error rolling dice:', error);
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –±—Ä–æ—Å–æ–∫ –∫–æ—Å—Ç–µ–π
            });
    }

    function handleDiceRollResult(result) {
        const diceContainer = document.querySelector('.dice-container');

        // Clear the container before adding new results
        diceContainer.innerHTML = '';

        // Create elements to display dice roll results
        const resultMessage = document.createElement('p');
        resultMessage.textContent = `–ü–µ—Ä–≤–∞—è –∫–æ—Å—Ç—å: ${result.die1}, –í—Ç–æ—Ä–∞—è –∫–æ—Å—Ç—å: ${result.die2}`;
        diceContainer.appendChild(resultMessage);

        // Create image elements for the rolled dice
        const dice1Image = document.createElement('img');
        dice1Image.src = `/static/dice${result.die1}.jpg`; // –ü—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –¥–ª—è –ø–µ—Ä–≤–æ–π –∫–æ—Å—Ç–∏
        dice1Image.alt = `Dice ${result.die1}`;
        diceContainer.appendChild(dice1Image);

        const dice2Image = document.createElement('img');
        dice2Image.src = `/static/dice${result.die2}.jpg`; // –ü—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –¥–ª—è –≤—Ç–æ—Ä–æ–π –∫–æ—Å—Ç–∏
        dice2Image.alt = `Dice ${result.die2}`;
        diceContainer.appendChild(dice2Image);

        // Handle discount applied logic
        if (result.discountApplied) {
            if (result.die1 === 6 && result.die2 === 6) {
                alert('–í—ã–ø–∞–ª–æ 6 –Ω–∞ –æ–±–µ–∏—Ö –∫–æ—Å—Ç—è—Ö! –ü—Ä–∏–º–µ–Ω—ë–Ω —Å–∫–∏–¥–æ—á–Ω—ã–π –∫—É–ø–æ–Ω –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç.');
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–∫–∏–¥–∫–∏ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç
            } else {
                alert('–ë—Ä–æ—Å–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω, –Ω–æ –Ω–µ –≤—ã–ø–∞–ª–æ –¥–≤–µ —à–µ—Å—Ç—ë—Ä–∫–∏.');
            }
        } else {
            alert('–ë—Ä–æ—Å–æ–∫ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–æ–¥—É–∫—Ç–∞.');
        }
    }

    // document.addEventListener('DOMContentLoaded', function() {
    //     fetchWeatherForBaku();
    //     checkTokenExpiration();
    //     const accessToken = sessionStorage.getItem('access_token');
    //     if (accessToken) {
    //         fetchUserInfo(accessToken);
    //     } else {
    //         hideMakeOrderButtonAndQuantity();
    //     }
    // });
    function viewCustomerOrders() {
        const accessToken = localStorage.getItem('access_token');
        const customerId = localStorage.getItem('customerId');

        if (!accessToken || !customerId) {
            console.error('Access token or customer ID is missing.');
            return;
        }

        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –∑–∞–∫–∞–∑–∞–º–∏, –ø–µ—Ä–µ–¥–∞–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ URL
        window.location.href = `/customer-order.html?customerId=${customerId}&accessToken=${accessToken}`;
    }

    function fetchWeatherForBaku() {
        fetch('/weather')
            .then(response => response.json())
            .then(data => {
                document.getElementById('weather-temperature').textContent = `${data.temperature}¬∞C`;
                document.getElementById('weather-icon').src = data.iconUrl;
                document.getElementById('weather-description').textContent = data.description;
            })
            .catch(error => {
                console.error('Error fetching weather data:', error);
                document.getElementById('weather-description').textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ';
            });
    }

    document.addEventListener('DOMContentLoaded', function() {
        fetchWeatherForBaku();
        checkTokenExpiration();
        const accessToken = localStorage.getItem('access_token');
        if (accessToken) {
            fetchUserInfo(accessToken);
        } else {
            hideMakeOrderButtonAndQuantity();
        }
    });


    function showMakeOrderButtonAndQuantity() {
        const makeOrderButtons = document.querySelectorAll('.make-order-button');
        const quantityInputs = document.querySelectorAll('.quantity-input');
        const quantityButtons = document.querySelectorAll('.quantity-btn');

        makeOrderButtons.forEach(button => button.style.display = 'block');
        quantityInputs.forEach(input => input.style.display = 'block');
        quantityButtons.forEach(button => button.style.display = 'block');
    }

    function hideMakeOrderButtonAndQuantity() {
        const makeOrderButtons = document.querySelectorAll('.make-order-button');
        const quantityInputs = document.querySelectorAll('.quantity-input');
        const quantityButtons = document.querySelectorAll('.quantity-btn');

        makeOrderButtons.forEach(button => button.style.display = 'none');
        quantityInputs.forEach(input => input.style.display = 'none');
        quantityButtons.forEach(button => button.style.display = 'none');
    }

    function fetchUserInfo(accessToken) {
        fetch('/user/me', {
            method: 'GET',
            headers: {
                'Authorization': 'Bearer ' + accessToken
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch user info');
                }
                return response.json();
            })
            .then(data => {
                showMakeOrderButtonAndQuantity(); // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ showMakeOrderButtonAndQuantity()
                document.getElementById('auth-links-logged-out').style.display = 'none';
                document.getElementById('auth-links-logged-in').style.display = 'block';
                document.getElementById('customer-name').textContent = data.name;
                localStorage.setItem('customerId', data.id);
                localStorage.setItem('customerName', data.name);
            })
            .catch(error => {
                console.error('Error fetching user info:', error);
                logout();
            });
    }

    // function checkTokenExpiration() {
    //     const accessTokenExpiration = sessionStorage.getItem('access_token_expiration');
    //     const refreshTokenExpiration = sessionStorage.getItem('refresh_token_expiration');
    //     const currentTime = new Date().getTime() / 1000;
    //     if (accessTokenExpiration && currentTime > accessTokenExpiration) {
    //         if (refreshTokenExpiration && currentTime > refreshTokenExpiration) {
    //             logout();
    //         } else {
    //             refreshToken();
    //         }
    //     }
    // }


    function refreshToken() {
        const refreshToken = localStorage.getItem('refresh_token');
        return fetch('/home/refresh', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ refreshToken: refreshToken })
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to refresh access token');
                }
                return response.json();
            })
            .then(data => {
                const { accessToken, refreshToken } = data;
                const currentTime = new Date().getTime();
                const accessTokenExpiration = currentTime + 30000; // 30 —Å–µ–∫—É–Ω–¥
                const refreshTokenExpiration = currentTime + 60000; // 1 –º–∏–Ω—É—Ç–∞

                localStorage.setItem('access_token', accessToken);
                localStorage.setItem('access_token_expiration', accessTokenExpiration.toString());
                localStorage.setItem('refresh_token', refreshToken);
                localStorage.setItem('refresh_token_expiration', refreshTokenExpiration.toString());
            });
    }

    function logout() {
        // –û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω—ã –∏ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        localStorage.removeItem('access_token');
        localStorage.removeItem('refresh_token');
        localStorage.removeItem('access_token_expiration');

        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞ –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥—Ä—É–≥–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
        window.location.href = '/login';
    }

    function logoutUser() {

        fetch('/logout', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => {
                if (response.ok) {
                    // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏–∑ localStorage –∏–ª–∏ sessionStorage
                    localStorage.removeItem('access_token');
                    localStorage.removeItem('refresh_token');
                    localStorage.removeItem('customerName');
                    localStorage.removeItem('customerId');
                    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    window.location.href = '/';
                } else {
                    console.error('Failed to logout:', response.statusText);

                }
            })
            .catch(error => {
                console.error('Error during logout:', error);
            });
    }

    // –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞


    const categoriesSection = document.getElementById('categories-section');
    const allCategoriesButton = document.getElementById('all-categories-button');
    const searchInput = document.getElementById('search-input');
    const searchButton = document.getElementById('search-button');
    const backButton = document.getElementById('back-button'); // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "Back"

    const productsSection = document.getElementById('products-section');
    const pagination = document.querySelector('.pagination');
    const diceContainer = document.querySelector('.dice-container');

    let pageStateHistory = []; // –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

    // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function savePageState() {
        const state = {
            productsHTML: productsSection.innerHTML,
            backButtonDisplay: backButton.style.display,
            allCategoriesButtonDisplay: allCategoriesButton.style.display,
            searchInputValue: searchInput.value.trim(),
            paginationDisplay: pagination.style.display // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
            // –î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è
        };

        pageStateHistory.push(state); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
    }

    // –§—É–Ω–∫—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function restorePageState(state) {
        if (state) {
            productsSection.innerHTML = state.productsHTML;
            backButton.style.display = state.backButtonDisplay;
            allCategoriesButton.style.display = state.allCategoriesButtonDisplay;
            searchInput.value = state.searchInputValue;

            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if (window.location.pathname === '/') {
                pagination.style.display = state.paginationDisplay;
            }

            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
            const productCards = document.querySelectorAll('.product-card');
            productCards.forEach(card => {
                card.addEventListener('click', productCardClickHandler);
            });
        }
    }

    function productCardClickHandler() {
        const productId = this.getAttribute('data-product-id');
        savePageState(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ–¥—É–∫—Ç–∞
        window.location.href = `/product-details?id=${productId}`;
    }

    document.addEventListener('DOMContentLoaded', function() {
        // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ pageStateHistory —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏–π
        if (pageStateHistory && pageStateHistory.length > 0) {
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            const lastState = pageStateHistory[pageStateHistory.length - 1];
            restorePageState(lastState);
        }
    });

    // –°–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–æ–∏—Å–∫–∞
    searchButton.addEventListener('click', function() {
        const keyword = searchInput.value.trim();
        if (keyword !== '') {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ø–æ–∏—Å–∫–∞
            savePageState();

            // –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–∏—Å–∫ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            fetch(`/home/search?keyword=${encodeURIComponent(keyword)}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to search products');
                    }
                    return response.json();
                })
                .then(products => {
                    // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–µ–∫—Ü–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
                    productsSection.innerHTML = '';

                    if (products.length === 0) {
                        productsSection.innerHTML = '<p>No products found.</p>';
                        return;
                    }

                    // –í—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –≤ —Å–µ–∫—Ü–∏—é –ø—Ä–æ–¥—É–∫—Ç–æ–≤
                    products.forEach(product => {
                        const productCard = document.createElement('div');
                        productCard.className = 'product-card';
                        productCard.dataset.productId = product.id; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º data-–∞—Ç—Ä–∏–±—É—Ç —Å ID –ø—Ä–æ–¥—É–∫—Ç–∞
                        productCard.innerHTML = `
                        <img src="${product.imageUrl || 'default-image-url.jpg'}" alt="Product Image">
                        <h3>${product.name || 'Unnamed'}</h3>
                        <p>${product.description || 'No description available.'}</p>
                        <p class="price">
                            ${product.discountPrice ?
                            `<span class="original-price">${product.price}</span>
                                <span class="discounted-price">${product.discountPrice}</span>` :
                            `<span>${product.price}</span>`}
                        </p>
                        <div class="quantity">
                            <button class="quantity-btn" onclick="decrementQuantity(this)">-</button>
                            <input type="number" class="quantity-input" value="1" min="1">
                            <button class="quantity-btn" onclick="incrementQuantity(this)">+</button>
                        </div>
                        <div class="rating" data-product-id="${product.id}">
                            <span class="star" data-value="5" onclick="rateProduct(this)">‚òÜ</span>
                            <span class="star" data-value="4" onclick="rateProduct(this)">‚òÜ</span>
                            <span class="star" data-value="3" onclick="rateProduct(this)">‚òÜ</span>
                            <span class="star" data-value="2" onclick="rateProduct(this)">‚òÜ</span>
                            <span class="star" data-value="1" onclick="rateProduct(this)">‚òÜ</span>
                        </div>
                        <div class="average-rating"></div> <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
                        <button class="make-order-button" onclick="makeOrder('${product.id}')">Make Order</button>
                    `;
                        productsSection.appendChild(productCard);

                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –ø—Ä–æ–¥—É–∫—Ç–∞ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏
                        updateAverageRating(product.id);
                    });

                    // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
                    pagination.style.display = 'none';

                    // –°–∫—Ä—ã–≤–∞–µ–º —Ä–∞–∑–¥–µ–ª "–ë—Ä–æ—Å–∏—Ç—å –∫–æ—Å—Ç–∏"
                    diceContainer.style.display = 'none';

                    // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "All Categories"
                    allCategoriesButton.style.display = 'none';

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "Back"
                    backButton.style.display = 'block';

                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
                    savePageState();
                })
                .catch(error => {
                    console.error('Error searching products:', error);
                    productsSection.innerHTML = '<p>Error searching products. Please try again later.</p>';

                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é –ø—Ä–∏ –æ—à–∏–±–∫–µ
                    pagination.style.display = 'block';

                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–¥–µ–ª "–ë—Ä–æ—Å–∏—Ç—å –∫–æ—Å—Ç–∏" –ø—Ä–∏ –æ—à–∏–±–∫–µ
                    diceContainer.style.display = 'block';

                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "All Categories" –ø—Ä–∏ –æ—à–∏–±–∫–µ
                    allCategoriesButton.style.display = 'block';

                    // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "Back" –ø—Ä–∏ –æ—à–∏–±–∫–µ
                    backButton.style.display = 'none';
                });
        }
    });



    // –°–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ "Back"
    // backButton.addEventListener('click', function() {
    //     // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    //     const prevState = pageStateHistory.pop(); // –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    //     restorePageState(prevState);
    //
    //     // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è –≤–≤–æ–¥–∞ –ø–æ–∏—Å–∫–∞, –µ—Å–ª–∏ –æ–Ω–æ –Ω–µ –ø—É—Å—Ç–æ–µ
    //     if (searchInput.value.trim() !== '') {
    //         searchInput.value = '';
    //     }
    //
    //     // –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
    //     categoriesSection.style.display = 'none';
    //     categoriesShown = false;
    // });

    let categoriesShown = false;

    allCategoriesButton.addEventListener('mouseenter', function() {
        if (!categoriesShown) {
            fetch('/home/categories')
                .then(response => response.json())
                .then(categories => {
                    categoriesSection.innerHTML = '';
                    categories.forEach(category => {
                        const categoryItem = document.createElement('li');
                        categoryItem.className = 'category-card';
                        categoryItem.innerHTML = `
                        <h3 class="category-name" data-category-id="${category.categoryId}">${category.name}</h3>
                    `;
                        categoriesSection.appendChild(categoryItem);
                    });
                    categoriesSection.style.display = 'flex';
                    categoriesShown = true;

                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                    savePageState();
                })
                .catch(error => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error));
        }
    });

    // –°–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –∫–ª–∏–∫–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –∑–¥–µ—Å—å)
    categoriesSection.addEventListener('click', function(event) {
        const target = event.target;
        if (target.classList.contains('category-name')) {
            const categoryId = target.dataset.categoryId;
            if (categoryId) {
                loadProducts(categoryId);
            }
        }
    });

    // –°–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –º—ã—à–∏
    document.addEventListener('mouseover', function(event) {
        const target = event.target;
        if (!target.closest('#all-categories-button') && !target.closest('#categories-section')) {
            if (!categoriesSection.dataset.productsShown) {
                categoriesSection.style.display = 'none';
                categoriesShown = false;
            }
        }
        checkTokenAvailability();
    });




    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã


    // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à—É —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é –∑–¥–µ—Å—å)


    function checkTokenAvailability() {
        const accessToken = localStorage.getItem('access_token');
        const productCards = document.querySelectorAll('.product-card');
        productCards.forEach(card => {
            const makeOrderButton = card.querySelector('button[data-action="make-order"]');
            if (accessToken) {
                makeOrderButton.style.display = 'block';
            } else {
                makeOrderButton.style.display = 'none';
            }

            const quantityButtons = card.querySelectorAll('.quantity-btn');
            const quantityInput = card.querySelector('.quantity-input');
            if (accessToken) {
                quantityButtons.forEach(button => {
                    button.style.display = 'inline-block';
                });
                quantityInput.style.display = 'inline-block';
            } else {
                quantityButtons.forEach(button => {
                    button.style.display = 'none';
                });
                quantityInput.style.display = 'none';
            }

            const ratingStars = card.querySelectorAll('.rating .star');
            if (accessToken) {
                ratingStars.forEach(star => {
                    star.style.display = 'inline-block';
                });
            } else {
                ratingStars.forEach(star => {
                    star.style.display = 'none';
                });
            }
        });
    }

    function saveCategoryState(categoryId) {
        const state = {
            categoryId: categoryId,
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø—Ä–æ–¥—É–∫—Ç–∞—Ö, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        };
        localStorage.setItem('categoryState', JSON.stringify(state));
    }

    function loadProducts(categoryId) {
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –ø—Ä–æ–¥—É–∫—Ç–æ–≤
        savePageState();

        fetch(`/home/${categoryId}/products`)
            .then(response => response.json())
            .then(products => {
                localStorage.setItem('products', JSON.stringify(products));
                productsSection.innerHTML = '';

                if (products.length === 0) {
                    productsSection.innerHTML = '<p>–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤.</p>';
                    return;
                }

                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    productCard.dataset.productId = product.id;
                    productCard.innerHTML = `
                <img src="${product.imageUrl}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
                <h3>${product.name}</h3>
                <p>${product.description}</p>
                <p class="price">
                    ${product.discountPrice ? `
                        <span class="original-price">${product.price}</span>
                        <span class="discounted-price">${product.discountPrice}</span>` :
                        `<span>${product.price}</span>`}
                </p>
                <div class="quantity">
                    <button data-action="quantity-btn" class="quantity-btn" onclick="decrementQuantity(this)" style="display: none;">-</button>
                    <input type="number" class="quantity-input" value="1" min="1">
                    <button data-action="quantity-btn" class="quantity-btn" onclick="incrementQuantity(this)" style="display: none;">+</button>
                </div>
                <button data-action="make-order" onclick="makeOrder(${product.id})" style="display: none;">Make Order</button>
                <div class="rating">
                    ${localStorage.getItem('access_token') ? `
                        <span class="star" data-value="1" onclick="rateProduct(this)">‚òÜ</span>
                        <span class="star" data-value="2" onclick="rateProduct(this)">‚òÜ</span>
                        <span class="star" data-value="3" onclick="rateProduct(this)">‚òÜ</span>
                        <span class="star" data-value="4" onclick="rateProduct(this)">‚òÜ</span>
                        <span class="star" data-value="5" onclick="rateProduct(this)">‚òÜ</span>` :
                        ''}
                </div>
                <div class="average-rating"></div>
            `;
                    productsSection.appendChild(productCard);

                    productCard.addEventListener('click', () => {
                        savePageState(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ–¥—É–∫—Ç–∞
                        window.location.href = `/product-details?id=${product.id}`;
                    });

                    // –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∞, –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –∏ –∑–≤–µ–∑–¥–æ—á–∫–∏
                    updateAverageRating(product.id);
                    // updateStars(product.id, parseInt(localStorage.getItem(`product_${product.id}_rating`)) || 0); // –û–±–Ω–æ–≤–ª—è–µ–º –∑–≤–µ–∑–¥–æ—á–∫–∏, –µ—Å–ª–∏ –æ—Ü–µ–Ω–∫–∞ —É–∂–µ –µ—Å—Ç—å
                });

                // –°–∫—Ä—ã—Ç–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                hidePagination();

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
                checkTokenAvailability();
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤:', error);
                productsSection.innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>';
            });

        // –°–∫—Ä—ã—Ç–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        diceContainer.style.display = 'none';
        backButton.style.display = 'block'; // –ü–æ–∫–∞–∑ –∫–Ω–æ–ø–∫–∏ "Back"
        searchInput.value = ''; // –û—á–∏—Å—Ç–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –ø–æ–ª—è
    }

    function hidePagination() {
        pagination.style.display = 'none';
    }

    function showPagination() {
        pagination.style.display = 'block';
    }

    backButton.addEventListener('click', function() {
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        const prevState = pageStateHistory.pop(); // –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        restorePageState(prevState);

        // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è –≤–≤–æ–¥–∞ –ø–æ–∏—Å–∫–∞, –µ—Å–ª–∏ –æ–Ω–æ –Ω–µ –ø—É—Å—Ç–æ–µ
        if (searchInput.value.trim() !== '') {
            searchInput.value = '';
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
        if (window.location.pathname === '/home') {
            showPagination(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        }

        categoriesSection.style.display = 'none';
        categoriesShown = false;
    });


    function makeOrder(productId) {
        // Log the productId for debugging purposes
        console.log('Product ID:', productId);

        // Retrieve access token from local storage
        let accessToken = localStorage.getItem('access_token');

        // Check if access token is missing
        if (!accessToken) {
            console.log('Access token is missing.');
            return;
        }

        // Use template literals for selector to find the product card
        const productCard = document.querySelector(`.product-card[data-product-id="${productId}"]`);
        // Log the selector used to find the product card
        console.log('Product Card Selector:', `.product-card[data-product-id="${productId}"]`);
        // Log the found product card element
        console.log('Product Card:', productCard);

        // Check if product card was not found
        if (!productCard) {
            console.error('Product card not found');
            return;
        }

        // Find the quantity input field within the product card
        const quantityInput = productCard.querySelector('.quantity-input');
        // Log the quantity input element
        console.log('Quantity Input:', quantityInput);

        // Parse the quantity input value to ensure it's a valid number
        const quantity = parseInt(quantityInput.value);
        // Log the parsed quantity value
        console.log('Quantity:', quantity);

        // Check if quantity is not a number or less than 1
        if (isNaN(quantity) || quantity < 1) {
            alert('Invalid quantity.');
            return;
        }

        // Create an order request object with product quantities
        const orderRequest = {
            productQuantities: {}
        };

        // Add the selected product and its quantity to the order request
        orderRequest.productQuantities[productId] = quantity;

        // Function to fetch the order
        function fetchOrder() {
            fetch('/home/makeOrder', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + accessToken
                },
                body: JSON.stringify(orderRequest)
            })
                .then(response => {
                    // Handle case where response status is 401 (Unauthorized)
                    if (response.status === 401) {
                        // Attempt to refresh access token and retry order request
                        return refreshAccessToken().then(({ newAccessToken, newRefreshToken }) => {
                            accessToken = newAccessToken;
                            localStorage.setItem('access_token', newAccessToken);
                            localStorage.setItem('refresh_token', newRefreshToken);
                            return fetchOrder();
                        });
                    }
                    // Handle case where response is not ok
                    if (!response.ok) {
                        // Parse response body as JSON and throw an error with its message
                        return response.json().then(error => {
                            throw new Error(error.message);
                        });
                    }
                    // Parse response body as JSON and return the data
                    return response.json();
                })
                .then(data => {
                    // Log success message with the returned data
                    console.log('Order placed successfully:', data);
                    // Store the orderId in local storage
                    localStorage.setItem('orderId', data.orderId);
                    // Redirect user to order details page
                    window.location.href = 'order-details';
                })
                .catch(error => {
                    // Check if error message indicates insufficient quantity
                    if (error.message.includes('Insufficient quantity')) {
                        alert('Insufficient quantity for the selected product.');
                    } else if (error.message === 'Insufficient balance') {
                        // Handle case where error message indicates insufficient balance
                        alert('Insufficient balance. Please add funds to your account.');
                    } else if (error.message === 'Unauthorized') {
                        // Redirect user to login page if error message indicates unauthorized access
                        window.location.href = '/login';
                    } else {
                        // Handle other errors with an alert and redirect to login page
                        alert('Error: ' + error.message);
                        window.location.href = '/login';
                    }
                    // Log the error message to the console
                    console.error('Error making order:', error);
                });
        }

        // Initiate the fetchOrder function to start the order process
        fetchOrder();
    }

    function incrementQuantity(element) {
        const productCard = element.closest('.product-card');
        const quantityInput = productCard.querySelector('.quantity-input');
        let value = parseInt(quantityInput.value);
        if (!isNaN(value)) {
            quantityInput.value = value + 1;
        }
    }

    function decrementQuantity(element) {
        const productCard = element.closest('.product-card');
        const quantityInput = productCard.querySelector('.quantity-input');
        let value = parseInt(quantityInput.value);
        if (!isNaN(value) && value > 1) {
            quantityInput.value = value - 1;
        }
    }



    function displayErrorMessage(errorMessage) {
        const errorElement = document.createElement('div');
        errorElement.textContent = errorMessage;
        document.body.appendChild(errorElement);
    }


    document.addEventListener('DOMContentLoaded', function() {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
        const productCards = document.querySelectorAll('.product-card');
        productCards.forEach(card => {
            const productId = card.getAttribute('data-product-id');

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞ –ø—Ä–æ–¥—É–∫—Ç–∞
            fetch(`/products/${productId}/rating`)
                .then(response => response.json())
                .then(averageRating => {
                    // –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞ –≤ —Ç–µ–∫—É—â–µ–π –∫–∞—Ä—Ç–æ—á–∫–µ –ø—Ä–æ–¥—É–∫—Ç–∞
                    const averageRatingContainer = card.querySelector('.average-rating');
                    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                    averageRatingContainer.innerHTML = '';
                    // –°–æ–∑–¥–∞–µ–º –∑–≤–µ–∑–¥–æ—á–∫–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞
                    for (let i = 1; i <= 5; i++) {
                        const star = document.createElement('span');
                        star.textContent = i <= averageRating ? '‚òÖ' : '‚òÜ';
                        averageRatingContainer.appendChild(star);
                    }
                })
                .catch(error => {
                    console.error(`Error loading average rating for product ${productId}:`, error);
                });

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –≤ localStorage
            const savedRating = localStorage.getItem(`product_${productId}_rating`);
            if (savedRating) {
                // –ù–∞—Ö–æ–¥–∏–º –∑–≤–µ–∑–¥–æ—á–∫—É, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –æ—Ü–µ–Ω–∫–µ, –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–≤–µ–∑–¥
                const stars = card.querySelectorAll('.rating .star');
                stars.forEach(star => {
                    const starValue = parseInt(star.getAttribute('data-value'));
                    if (starValue <= parseInt(savedRating)) {
                        star.textContent = '‚òÖ';
                        star.classList.add('active'); // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –∑–≤–µ–∑–¥—ã
                    } else {
                        star.textContent = '‚òÜ';
                        star.classList.remove('active'); // –£–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π –∑–≤–µ–∑–¥—ã
                    }
                });
            }
        });
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∞
    function updateStars(productId, ratingValue) {
        const accessToken = localStorage.getItem('access_token');
        const productCard = document.querySelector(`.product-card[data-product-id="${productId}"]`);

        if (!accessToken) {
            // –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —Å–∫—Ä—ã–≤–∞–µ–º –∑–≤–µ–∑–¥–æ—á–∫–∏
            const stars = productCard.querySelectorAll('.rating .star');
            stars.forEach(star => {
                star.style.display = 'none'; // –ü—Ä—è—á–µ–º –∑–≤–µ–∑–¥–æ—á–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–¥–µ–ª–∞–µ–º –∏—Ö –Ω–µ–≤–∏–¥–∏–º—ã–º–∏
            });
            return;
        }

        // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–≤–µ–∑–¥–æ—á–µ–∫, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –µ—Å—Ç—å
        if (productCard) {
            const stars = productCard.querySelectorAll('.rating .star');
            stars.forEach(star => {
                const starValue = parseInt(star.getAttribute('data-value'));
                if (starValue <= ratingValue) {
                    star.textContent = '‚òÖ';
                    star.classList.add('active'); // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –∑–≤–µ–∑–¥—ã
                } else {
                    star.textContent = '‚òÜ';
                    star.classList.remove('active'); // –£–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π –∑–≤–µ–∑–¥—ã
                }
            });
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ü–µ–Ω–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    function rateProduct(iconElement) {
        // –ù–∞—Ö–æ–¥–∏–º –±–ª–∏–∂–∞–π—à–∏–π —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å –∫–ª–∞—Å—Å–æ–º '.product-card'
        let productCard = iconElement;
        while (productCard && !productCard.classList.contains('product-card')) {
            productCard = productCard.parentNode;
        }

        if (!productCard) {
            console.error('Product card not found. Unable to rate product.');
            return;
        }

        const productId = productCard.getAttribute('data-product-id');
        const ratingValue = parseInt(iconElement.getAttribute('data-value'));

        const accessToken = localStorage.getItem('access_token');
        if (!accessToken) {
            console.error('Access token not found. Unable to rate product.');
            return;
        }

        // –ü—Ä–∏–º–µ—Ä –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è ratingData –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        const ratingData = {
            rating: ratingValue === 1 ? 1 : -1,
            productId: productId,
            customerId: localStorage.getItem('customerId')
        };
        console.log('Rating data:', ratingData);

        fetch(`/ratings/${productId}/rate`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + accessToken
            },
            body: JSON.stringify(ratingData)
        })
            .then(response => {
                if (!response.ok) {
                    if (response.status === 401) {
                        console.error('Unauthorized: User logged out');
                        // –î–æ–±–∞–≤—å—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
                    }
                    throw new Error('Failed to rate product');
                }
                return response.json();
            })
            .then(data => {
                console.log('Product rated successfully:', data.message);
                // –î–æ–±–∞–≤—å—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ—Ü–µ–Ω–∫–µ –ø—Ä–æ–¥—É–∫—Ç–∞
                // –ù–∞–ø—Ä–∏–º–µ—Ä, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                updateRatingIcons(iconElement, ratingValue);
            })
            .catch(error => {
                console.error('Error rating product:', error);
            });
    }
    function updateRatingIcons(iconElement, ratingValue) {
        // –°–Ω–∏–º–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–æ –≤—Å–µ—Ö –∏–∫–æ–Ω–æ–∫
        const icons = iconElement.parentElement.querySelectorAll('.rating span');
        icons.forEach(icon => {
            icon.classList.remove('active');
        });

        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é –∏–∫–æ–Ω–∫—É
        iconElement.classList.add('active');
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    function updateAverageRating(productId) {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞ –ø—Ä–æ–¥—É–∫—Ç–∞
        fetch(`/products/${productId}/rating`)
            .then(response => response.json())
            .then(averageRating => {
                // –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ä—Ç–æ—á–∫—É –ø—Ä–æ–¥—É–∫—Ç–∞ –ø–æ ID
                const productCard = document.querySelector(`.product-card[data-product-id="${productId}"]`);
                if (productCard) {
                    // –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞ –≤ —Ç–µ–∫—É—â–µ–π –∫–∞—Ä—Ç–æ—á–∫–µ –ø—Ä–æ–¥—É–∫—Ç–∞
                    const averageRatingContainer = productCard.querySelector('.average-rating');
                    if (averageRatingContainer) {
                        // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                        averageRatingContainer.innerHTML = '';
                        // –°–æ–∑–¥–∞–µ–º –∑–≤–µ–∑–¥–æ—á–∫–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞
                        for (let i = 1; i <= 5; i++) {
                            const star = document.createElement('span');
                            star.textContent = i <= averageRating ? '‚òÖ' : '‚òÜ';
                            averageRatingContainer.appendChild(star);
                        }
                    }
                }
            })
            .catch(error => {
                console.error(`Error updating average rating for product ${productId}:`, error);
            });
    }

    // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∑–≤–µ–∑–¥–æ—á–∫–∏
    document.addEventListener('DOMContentLoaded', function() {
        const productCards = document.querySelectorAll('.product-card');
        productCards.forEach(card => {
            const icons = card.querySelectorAll('.rating span');
            icons.forEach(icon => {
                icon.addEventListener('click', function() {
                    rateProduct(icon);
                });
            });

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
            const productId = card.getAttribute('data-product-id');
            fetch(`/products/${productId}/rating`)
                .then(response => response.json())
                .then(averageRating => {
                    const averageRatingContainer = card.querySelector('.average-rating');
                    averageRatingContainer.innerHTML = '';
                    for (let i = 1; i <= 5; i++) {
                        const star = document.createElement('span');
                        star.textContent = i <= averageRating ? '‚òÖ' : '‚òÜ';
                        averageRatingContainer.appendChild(star);
                    }
                })
                .catch(error => {
                    console.error(`Error loading average rating for product ${productId}:`, error);
                });

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –≤ localStorage
            const savedRating = localStorage.getItem(`product_${productId}_rating`);
            if (savedRating) {
                updateRatingIcons(card.querySelector(`.rating span[data-value="${savedRating}"]`), parseInt(savedRating));
            }
        });
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–¥—É–∫—Ç–µ
    // function showProductDetails(productId) {
    //     fetch(`/products/${productId}`)
    //         .then(response => response.json())
    //         .then(product => {
    //             const productDetails = document.getElementById('product-details'); // –≠–ª–µ–º–µ–Ω—Ç, –∫—É–¥–∞ –±—É–¥–µ–º –≤—ã–≤–æ–¥–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    //             if (productDetails) {
    //                 productDetails.innerHTML = `
    //                     <h2>${product.name}</h2>
    //                     <img src="${product.imageUrl}" alt="${product.name}">
    //                     <p>${product.description}</p>
    //                     <p class="price">
    //                         ${product.discountPrice ? `
    //                             <span class="original-price">${product.price}</span>
    //                             <span class="discounted-price">${product.discountPrice}</span>` :
    //                     `<span>${product.price}</span>`}
    //                     </p>
    //                     <div class="quantity">
    //                         <button data-action="quantity-btn" class="quantity-btn" onclick="decrementQuantity(this)" style="display: none;">-</button>
    //                         <input type="number" class="quantity-input" value="1" min="1">
    //                         <button data-action="quantity-btn" class="quantity-btn" onclick="incrementQuantity(this)" style="display: none;">+</button>
    //                     </div>
    //                     <button data-action="make-order" onclick="makeOrder(${product.id})" style="display: none;">Make Order</button>
    //                     <div class="rating">
    //                         ${localStorage.getItem('access_token') ? `
    //                             <span class="star" data-value="1" onclick="rateProduct(this)">‚òÜ</span>
    //                             <span class="star" data-value="2" onclick="rateProduct(this)">‚òÜ</span>
    //                             <span class="star" data-value="3" onclick="rateProduct(this)">‚òÜ</span>
    //                             <span class="star" data-value="4" onclick="rateProduct(this)">‚òÜ</span>
    //                             <span class="star" data-value="5" onclick="rateProduct(this)">‚òÜ</span>` :
    //                     ''}
    //                     </div>
    //                     <div class="average-rating"></div>
    //                 `;
    //                 updateAverageRating(productId); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∞
    //
    //                 // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–∞
    //                 productDetails.style.display = 'block';
    //             } else {
    //                 console.error('–≠–ª–µ–º–µ–Ω—Ç product-details –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ DOM.');
    //             }
    //         })
    //         .catch(error => {
    //             console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–¥—É–∫—Ç–µ:', error);
    //             const productDetails = document.getElementById('product-details');
    //             if (productDetails) {
    //                 productDetails.innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–¥—É–∫—Ç–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>';
    //                 productDetails.style.display = 'block';
    //             }
    //         });
    // }
    //
    // // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –Ω–∞ –∫–∞–∂–¥—É—é –∫–∞—Ä—Ç–æ—á–∫—É –ø—Ä–æ–¥—É–∫—Ç–∞
    // document.addEventListener('DOMContentLoaded', function() {
    //     const productCards = document.querySelectorAll('.product-card');
    //     productCards.forEach(card => {
    //         card.addEventListener('click', function() {
    //             const productId = card.getAttribute('data-product-id');
    //             showProductDetails(productId);
    //         });
    //     });
    // });



</script>
</body>
</html>